#!/bin/bash

# Post-commit hook: Update cache-busting version numbers after each commit

# Generate new version number (current timestamp)
NEW_VERSION=$(date +%s)

# Get the repository root directory
REPO_ROOT=$(git rev-parse --show-toplevel)

# Change to repository root
cd "$REPO_ROOT" || exit

# Update all HTML files with new version
sed -i '' "s/styles\.css?v=[0-9]*/styles.css?v=$NEW_VERSION/g" *.html
sed -i '' "s/content\.js?v=[0-9]*/content.js?v=$NEW_VERSION/g" *.html

# Stage the version changes
git add *.html

# Amend the commit to include version updates (silent)
git commit --amend --no-edit --no-verify

echo "âœ“ Cache-busting version updated to: $NEW_VERSION"
