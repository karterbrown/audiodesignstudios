<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Audio Design Studios – Karter G. Brown</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <header class="site-header">
    <div class="logo">Audio Design Studios</div>
    <nav class="nav">
      <a href="index.html">Home</a>
      <a href="portfolio.html">Portfolio</a>
      <a href="about.html">About</a>
      <a href="music.html">Music</a>
    </nav>
  </header>

  <main>
    <section class="env-image env-portfolio"></section>

    <section id="portfolio" class="hero">
      <div class="hero-content">
        <h1>Highlights</h1>
        <p>Listen to featured audio samples from my recent work including film scores, game design, and original compositions.</p>
        <div class="highlights-banner">
          <picture>
            <source media="(min-width:1200px)" srcset="highlightstextimage/homepiano2000.webp">
            <source media="(min-width:720px)" srcset="highlightstextimage/homepiano1400.webp">
            <img src="highlightstextimage/homepiano800.webp" alt="Highlights banner" />
          </picture>
        </div>
      </div>

      <div class="highlights-section">
        <div class="player-wrapper">
          <div class="player-left">
            <div class="album-cover" aria-hidden="true">
              <picture>
                <source media="(min-width:1200px)" srcset="highlights/staticcurrents2000.webp">
                <source media="(min-width:720px)" srcset="highlights/staticcurrents1400.webp">
                <img id="albumCover" src="highlights/staticcurrents800.webp" alt="Highlights album cover" />
              </picture>
            </div>
          </div>

          <div class="player-right">
            <div class="playlist" id="playlist">
              <!-- Track rows will be injected here -->
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="playlists-section">
      <div class="playlists-container">
        <!-- Left Playlist: Daughter of the Plains -->
        <div class="playlist-card">
          <div class="playlist-card-header">
            <div class="playlist-album-art" id="dotpArt">
              <picture>
                <source media="(min-width:1200px)" srcset="daughteroftheplains/daughteroftheplains2000.webp">
                <source media="(min-width:720px)" srcset="daughteroftheplains/daughteroftheplains1400.webp">
                <img src="daughteroftheplains/daughteroftheplains800.webp" alt="Daughter of the Plains">
              </picture>
            </div>
            <h3>Daughter of the Plains</h3>
          </div>
          <div id="mainWave" class="playlist-waveform" aria-hidden="true"></div>
          <div class="playlist-player-controls">
            <button id="prevBtn" class="control-btn" aria-label="Back to beginning">⏮</button>
            <button id="playPauseBtn" class="control-btn control-btn-play" aria-label="Play/Pause">▶</button>
            <button id="nextBtn" class="control-btn" aria-label="Next track">⏭</button>
          </div>
          <div class="playlist-content" id="dotpPlaylist">
            <!-- Tracks will be injected here -->
          </div>
        </div>

        <!-- Right Playlist: All Works -->
        <div class="playlist-card">
          <div class="playlist-card-header">
            <div class="playlist-album-art" id="allWorksArt">
              <img src="Photos/headshot.webp" alt="All Works">
            </div>
            <h3>All Works</h3>
          </div>
          <div id="allMainWave" class="playlist-waveform" aria-hidden="true"></div>
          <div class="playlist-player-controls">
            <button id="allPrevBtn" class="control-btn" aria-label="Back to beginning">⏮</button>
            <button id="allPlayPauseBtn" class="control-btn control-btn-play" aria-label="Play/Pause">▶</button>
            <button id="allNextBtn" class="control-btn" aria-label="Next track">⏭</button>
          </div>
          <div class="playlist-scroll" id="allWorksPlaylist">
            <!-- Tracks will be injected here -->
          </div>
        </div>
      </div>
    </section>
  </main>

<footer class="site-footer">
  <div class="footer-content">
     <h2>Contact</h2>
     <p>Email: <a href="mailto:music@kartergbrown.com">music@kartergbrown.com</a></p>

     <p class="footer-copy">
     © <span id="year"></span> Audio Design Studios. All rights reserved.
     </p>
  </div>
</footer>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>
  <!-- Waveform player (WaveSurfer) -->
  <script src="https://unpkg.com/wavesurfer.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      if (typeof WaveSurfer === 'undefined') {
        console.error('WaveSurfer library failed to load');
        return;
      }

      // --- Highlights mini-players ---
      const highlights = [
        { id: 'track1', title: 'Neon Wasteland', url: 'highlights/NeonWasteland_FullMix.mp3' },
        { id: 'track2', title: 'Interstellar Worlds Align', url: 'highlights/Interstellar Worlds Align.mp3' },
        { id: 'track3', title: 'Buried Trials', url: 'highlights/BuriedTrials_FullMix.mp3' }
      ];

      const highlightsContainer = document.getElementById('playlist');

      function createHighlightRow(track) {
        const row = document.createElement('div');
        row.className = 'track-row';

        const header = document.createElement('div');
        header.className = 'track-header';

        const num = document.createElement('div');
        num.className = 'track-number';
        num.textContent = track.id.replace('track', '');

        const btn = document.createElement('button');
        btn.className = 'play-btn';
        btn.setAttribute('aria-label', `Play ${track.title}`);
        btn.textContent = '▶';

        const title = document.createElement('div');
        title.className = 'track-title';
        title.textContent = track.title;

        const wave = document.createElement('div');
        wave.className = 'waveform';
        wave.id = `wave_${track.id}`;

        header.appendChild(num);
        header.appendChild(btn);
        header.appendChild(title);

        row.appendChild(header);
        row.appendChild(wave);

        const ws = WaveSurfer.create({
          container: wave,
          waveColor: '#6d6d76',
          progressColor: '#31c49f',
          height: 40,
          responsive: true,
          normalize: true
        });

        wave.addEventListener('contextmenu', (e) => e.preventDefault());
        ws.load(track.url);

        ws.on('error', (e) => {
          console.error('WaveSurfer error for', track.title, ':', e);
        });

        btn.addEventListener('click', () => ws.playPause());
        ws.on('play', () => { btn.textContent = '⏸'; });
        ws.on('pause', () => { btn.textContent = '▶'; });
        ws.on('finish', () => { btn.textContent = '▶'; });

        highlightsContainer.appendChild(row);
      }

      highlights.forEach(createHighlightRow);

      // --- Player instances (per playlist) ---
      const mainWaveEl = document.getElementById('mainWave');
      const mainWs = WaveSurfer.create({
        container: mainWaveEl,
        waveColor: '#6d6d76',
        progressColor: '#31c49f',
        height: 37,
        responsive: true,
        normalize: true
      });
      if (mainWaveEl) mainWaveEl.addEventListener('contextmenu', (e) => e.preventDefault());

      const allMainWaveEl = document.getElementById('allMainWave');
      const allMainWs = WaveSurfer.create({
        container: allMainWaveEl,
        waveColor: '#6d6d76',
        progressColor: '#31c49f',
        height: 37,
        responsive: true,
        normalize: true
      });
      if (allMainWaveEl) allMainWaveEl.addEventListener('contextmenu', (e) => e.preventDefault());

      const playPauseBtn = document.getElementById('playPauseBtn');
      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');

      const allPlayPauseBtn = document.getElementById('allPlayPauseBtn');
      const allPrevBtn = document.getElementById('allPrevBtn');
      const allNextBtn = document.getElementById('allNextBtn');

      const playlistButtonLookup = {
        dotp: 'dotpPlaylist',
        allWorks: 'allWorksPlaylist'
      };

      const getTrackButtons = (key) => {
        const containerId = playlistButtonLookup[key];
        if (!containerId) return [];
        const container = document.getElementById(containerId);
        return container ? Array.from(container.querySelectorAll('.track-item-play-btn')) : [];
      };

      const players = {
        dotp: {
          ws: mainWs,
          controls: { playPauseBtn, prevBtn, nextBtn },
          current: null,
          key: 'dotp'
        },
        allWorks: {
          ws: allMainWs,
          controls: { playPauseBtn: allPlayPauseBtn, prevBtn: allPrevBtn, nextBtn: allNextBtn },
          current: null,
          key: 'allWorks'
        }
      };

      function loadAndPlayInPlayer(playerKey, track, btn, itemProgressEl, timeEl) {
        const ctx = players[playerKey];
        if (!ctx) return;
        const url = typeof track === 'string' ? track : track.url || track;
        if (!url) return;

        if (ctx.current && ctx.current.btn === btn) {
          ctx.ws.playPause();
          return;
        }

        if (ctx.current?.btn) ctx.current.btn.textContent = '▶';
        ctx.current = { btn, itemProgressEl, timeEl };
        btn.textContent = '…';

        try {
          ctx.ws.load(url);
          ctx.ws.once('ready', () => ctx.ws.play());
        } catch (e) {
          console.warn('player load failed', e);
        }
      }

      function attachWaveEvents(playerKey) {
        const ctx = players[playerKey];
        if (!ctx) return;
        const { ws, controls } = ctx;

        ws.on('audioprocess', () => {
          if (!ctx.current) return;
          const cur = ws.getCurrentTime() || 0;
          const dur = ws.getDuration() || 0;
          const pct = dur ? (cur / dur) : 0;
          if (ctx.current.itemProgressEl) ctx.current.itemProgressEl.style.width = `${pct * 100}%`;
          if (ctx.current.timeEl) ctx.current.timeEl.textContent = `${formatTime(cur)} / ${formatTime(dur)}`;
        });

        ws.on('play', () => {
          if (controls.playPauseBtn) controls.playPauseBtn.textContent = '⏸';
          if (ctx.current?.btn) ctx.current.btn.textContent = '⏸';
        });

        ws.on('pause', () => {
          if (controls.playPauseBtn) controls.playPauseBtn.textContent = '▶';
          if (ctx.current?.btn) ctx.current.btn.textContent = '▶';
        });

        ws.on('finish', () => {
          if (controls.playPauseBtn) controls.playPauseBtn.textContent = '▶';
          if (ctx.current?.btn) ctx.current.btn.textContent = '▶';
          if (ctx.current?.itemProgressEl) ctx.current.itemProgressEl.style.width = '0%';
        });
      }

      attachWaveEvents('dotp');
      attachWaveEvents('allWorks');

      // --- Playlist data ---
      const daughterOfPlainsData = [
        { title: 'Daughter of the Plains (Score)', url: 'daughteroftheplains/01daughteroftheplainsscore.mp3' },
        { title: 'BIG', url: 'daughteroftheplains/02big.mp3' },
        { title: 'Alisons Theme', url: 'daughteroftheplains/03alisonstheme.mp3' },
        { title: 'Like A Child', url: 'daughteroftheplains/04likeachild.mp3' },
        { title: 'Daughter of the Plains (Motif)', url: 'daughteroftheplains/05daughteroftheplainsmotif.mp3' }
      ];

      const allWorksData = [
        { title: 'Hopeful', url: 'allworks/hopeful.mp3' },
        { title: 'Those Who Save Lives', url: 'allworks/thosewhosavelives.mp3' },
        { title: 'The Revolt', url: 'allworks/therevolt.mp3' },
        { title: 'Slave to Spiritual Death', url: 'allworks/slavetospiritualdeath.mp3' },
        { title: 'One Step Closer', url: 'allworks/onestepcloser.mp3' },
        { title: 'Reggae Demo', url: 'allworks/reggaedemo.mp3' },
        { title: 'Chime and Glimmer', url: 'allworks/chimeandglimmer.mp3' },
        { title: 'Cavalry March', url: 'allworks/cavalrymarch.mp3' },
      ];

      // --- Shared playlist items ---
      function formatTime(sec) {
        const safeSec = Math.max(0, Math.floor(sec || 0));
        const m = Math.floor(safeSec / 60);
        const s = safeSec % 60;
        return `${m}:${s.toString().padStart(2, '0')}`;
      }

      function createPlaylistItem(track, index, playlistKey) {
        const item = document.createElement('div');
        item.className = 'track-item';

        const info = document.createElement('div');
        info.className = 'track-item-info';

        const num = document.createElement('div');
        num.className = 'track-item-number';
        num.textContent = `${index + 1}`;

        const title = document.createElement('div');
        title.className = 'track-item-title';
        title.textContent = track.title;

        const progressWrap = document.createElement('div');
        progressWrap.className = 'track-item-progress-wrap';
        const progressFill = document.createElement('div');
        progressFill.className = 'track-item-progress-fill';
        progressFill.style.width = '0%';
        progressWrap.appendChild(progressFill);

        const timeEl = document.createElement('div');
        timeEl.className = 'track-item-time';
        timeEl.textContent = '0:00 / 0:00';

        info.appendChild(num);
        info.appendChild(title);
        info.appendChild(progressWrap);

        const btn = document.createElement('button');
        btn.className = 'track-item-play-btn';
        btn.setAttribute('aria-label', `Play ${track.title}`);
        btn.textContent = '▶';

        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          loadAndPlayInPlayer(playlistKey, track, btn, progressFill, timeEl);
        });

        let isDragging = false;

        const updateProgress = (e) => {
          const rect = progressWrap.getBoundingClientRect();
          const pct = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));
          const targetWs = players[playlistKey]?.ws;
          try { targetWs?.seekTo(pct); } catch (_err) {}
        };

        progressWrap.addEventListener('mousedown', (e) => {
          e.stopPropagation();
          isDragging = true;
          updateProgress(e);
          progressWrap.style.cursor = 'grabbing';
        });

        document.addEventListener('mousemove', (e) => {
          if (isDragging) {
            e.preventDefault();
            updateProgress(e);
          }
        });

        document.addEventListener('mouseup', () => {
          if (isDragging) {
            isDragging = false;
            progressWrap.style.cursor = 'pointer';
          }
        });

        progressWrap.addEventListener('click', (e) => {
          e.stopPropagation();
          if (!isDragging) updateProgress(e);
        });

        item.appendChild(info);
        item.appendChild(timeEl);
        item.appendChild(btn);

        return item;
      }

      const dotpEl = document.getElementById('dotpPlaylist');
      const allWorksEl = document.getElementById('allWorksPlaylist');

      daughterOfPlainsData.forEach((track, idx) => {
        dotpEl.appendChild(createPlaylistItem(track, idx, 'dotp'));
      });

      allWorksData.forEach((track, idx) => {
        allWorksEl.appendChild(createPlaylistItem(track, idx, 'allWorks'));
      });

      dotpEl.addEventListener('contextmenu', (e) => e.preventDefault());
      allWorksEl.addEventListener('contextmenu', (e) => e.preventDefault());

      // --- Transport controls (per playlist) ---
      function attachTransportHandlers(playerKey) {
        const ctx = players[playerKey];
        if (!ctx) return;
        const { controls, ws } = ctx;

        const handlePlayPause = () => {
          if (!ctx.current) {
            const firstBtn = getTrackButtons(playerKey)[0];
            if (firstBtn) {
              firstBtn.click();
              return;
            }
          }
          ws.playPause();
        };

        const handlePrev = () => {
          if (ws.getCurrentTime() > 3) {
            ws.seekTo(0);
            return;
          }
          const buttons = getTrackButtons(playerKey);
          const currentIdx = buttons.findIndex((btn) => btn === ctx.current?.btn);
          if (currentIdx > 0) buttons[currentIdx - 1].click();
        };

        const handleNext = () => {
          const buttons = getTrackButtons(playerKey);
          const currentIdx = buttons.findIndex((btn) => btn === ctx.current?.btn);
          if (currentIdx >= 0 && currentIdx < buttons.length - 1) buttons[currentIdx + 1].click();
        };

        if (controls.playPauseBtn) controls.playPauseBtn.addEventListener('click', handlePlayPause);
        if (controls.prevBtn) controls.prevBtn.addEventListener('click', handlePrev);
        if (controls.nextBtn) controls.nextBtn.addEventListener('click', handleNext);
      }

      attachTransportHandlers('dotp');
      attachTransportHandlers('allWorks');

      // --- Misc ---
      const album = document.getElementById('albumCover');
      if (album) album.setAttribute('draggable', 'false');
    });
  </script>
</body>
</html>   